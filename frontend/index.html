<!DOCTYPE html>
<html>
<head>
    <title>Enrolment Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
    <h2>Enrolment Report</h2>
    <div class="mb-3">
        <select id="userFilter" class="form-select w-auto d-inline" onchange="loadData()">
            <option value="">All Users</option>
        </select>
        <select id="courseFilter" class="form-select w-auto d-inline" onchange="loadData()">
            <option value="">All Courses</option>
        </select>
        <button onclick="loadData()" class="btn btn-primary">Search</button>
    </div>
    <table class="table table-bordered" id="results">
        <thead>
            <tr>
                <th>ID</th><th>Name</th><th>Course</th><th>Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
<script>
function loadUsers() {
    fetch('/api/get_users.php').then(r=>r.json()).then(users=>{
        let sel = document.getElementById('userFilter');
        sel.innerHTML = '<option value="">All Users</option>';
        users.forEach(u=>sel.innerHTML += `<option value="${u.user_id}">${u.first_name} ${u.surname}</option>`);
    });
}
function loadCourses() {
    fetch('/api/get_courses.php').then(r=>r.json()).then(courses=>{
        let sel = document.getElementById('courseFilter');
        sel.innerHTML = '<option value="">All Courses</option>';
        courses.forEach(c=>sel.innerHTML += `<option value="${c.course_id}">${c.description}</option>`);
    });
}
function loadData() {
    let user = document.getElementById('userFilter').value;
    let course = document.getElementById('courseFilter').value;
    let url = '/api/get_enrolments.php';
    let params = [];
    if (user) params.push('user_id='+user);
    if (course) params.push('course_id='+course);
    if (params.length) url += '?' + params.join('&');
    fetch(url)
        .then(r => {
            if (!r.ok) throw new Error('Network response was not ok');
            return r.json();
        })
        .then(data => {
            let tbody = document.querySelector('#results tbody');
            tbody.innerHTML = '';
            data.forEach(row => {
                tbody.innerHTML += `<tr>
                    <td>${row.enrolment_id}</td>
                    <td>${row.first_name} ${row.surname}</td>
                    <td>${row.description}</td>
                    <td>${row.completion_status}</td>
                </tr>`;
            });
        })
        .catch(err => {
            let tbody = document.querySelector('#results tbody');
            tbody.innerHTML = '';
            alert('Failed to load data: ' + err.message);
        });
}
window.onload = function() {
    loadUsers();
    loadCourses();
    loadData();
};
</script>
</body>
</html> 